<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 ç’€ç’¨ä¹‹çº¦ Â· éœ‡æ’¼å¢å¼ºç‰ˆ</title>
    <style>
        :root { 
            --gold: #f3cf7a; 
            --red: #d32f2f;
            --glass: rgba(15, 15, 15, 0.85);
            --accent: #f3cf7a;
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: -apple-system, sans-serif; transition: background 2s; }

        /* è§†é¢‘çª— */
        .video-window {
            position: absolute; right: 15px; top: 15px; width: 120px; height: 68px;
            z-index: 20; border-radius: 8px; border: 1px solid rgba(243, 207, 122, 0.5);
            overflow: hidden; background: #000;
            box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 10px rgba(243, 207, 122, 0.2);
            filter: contrast(1.1) brightness(1.1);
        }
        #side-video { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }

        canvas { position: absolute; inset: 0; z-index: 5; pointer-events: none; }

        /* éŸ³ä¹æ§åˆ¶ */
        .audio-box {
            position: absolute; left: 15px; top: 15px; z-index: 2500;
            display: flex; align-items: center; gap: 10px; background: var(--glass);
            padding: 5px 12px; border-radius: 30px; border: 1px solid var(--gold);
            backdrop-filter: blur(10px);
        }
        .music-ctrl { cursor: pointer; font-size: 18px; color: var(--gold); }
        #volume-slider { width: 60px; height: 3px; accent-color: var(--gold); cursor: pointer; }

        /* å€’è®¡æ—¶ */
        #timer-wrap {
            position: absolute; inset: 0; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10; pointer-events: none;
        }
        #timer { 
            font-size: clamp(80px, 15vw, 120px); font-weight: 100; color: #fff; 
            text-shadow: 0 0 30px var(--gold); letter-spacing: 5px;
        }

        #count-down-boom {
            position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
            font-size: 160px; font-weight: 900; color: var(--gold);
            z-index: 1500; opacity: 0; pointer-events: none;
            text-shadow: 0 0 60px var(--gold);
        }

        /* å¼¹å¹•å‘é€åŒº */
        .console {
            position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%);
            z-index: 2000; display: flex; width: 85%; max-width: 380px; 
            padding: 8px 18px; background: var(--glass); border-radius: 30px; 
            border: 1px solid rgba(243, 207, 122, 0.4); backdrop-filter: blur(10px);
        }
        .console input { background: transparent; border: none; color: #fff; flex: 1; outline: none; font-size: 14px; }
        .console button { background: var(--gold); border: none; border-radius: 50%; width: 34px; height: 34px; font-weight: bold; color: #821111; cursor: pointer;}

        /* çº¢åŒ…é˜µåˆ— */
        #packet-grid {
            position: absolute; inset: 0; display: grid; 
            grid-template-columns: repeat(2, 1fr); grid-gap: 20px;
            padding: 120px 40px; z-index: 100; display: none;
            justify-items: center; align-content: center;
        }
        .packet-item {
            width: 100px; height: 140px; background: linear-gradient(135deg, #b71c1c, #d32f2f);
            border-radius: 12px; border: 2px solid var(--gold);
            position: relative; animation: wobble 2s infinite;
            box-shadow: 0 10px 30px rgba(183, 28, 28, 0.5); transition: 0.3s;
        }
        @keyframes wobble { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
        .seal { 
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); 
            width: 48px; height: 48px; background: var(--gold); border-radius: 50%; 
            color: #b71c1c; font-weight: 900; display: flex; align-items: center; justify-content: center; font-size: 24px;
        }

        /* æœ€ç»ˆç¥ç¦è¯­ */
        #final-msg {
            position: absolute; inset: 0; display: flex; justify-content: center; align-items: center;
            z-index: 400; font-size: 32px; font-weight: bold; text-align: center;
            opacity: 0; transition: 3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            letter-spacing: 8px; line-height: 2.2; pointer-events: none;
            background: linear-gradient(to right, #f3cf7a 20%, #fff 50%, #f3cf7a 80%);
            background-size: 200% auto;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        #final-msg.show { 
            opacity: 1; transform: scale(1.15); 
            animation: shine 3s linear infinite;
        }

        /* åŠ¨ç”»åº“ */
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-15px) rotate(5deg); } }
        @keyframes pulse { 0% { opacity:0.3; } 50% { opacity:0.8; } 100% { opacity:0.3; } }
        @keyframes shine { to { background-position: 200% center; } }
        @keyframes boomAnim {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
        @keyframes gather { 
            0% { opacity: 0; transform: translate(-50%, 50%) scale(0.8); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
            100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); }
        }

        .final-glow::before {
            content:''; position:fixed; inset:0; pointer-events:none; z-index: 1;
            background: radial-gradient(circle at center, rgba(243,207,122,0.2), transparent 75%);
            animation: pulse 4s infinite ease-in-out;
        }

        #gate { position: fixed; inset: 0; background: #000; z-index: 3000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--gold); cursor: pointer; }
    </style>
</head>
<body onclick="manualFire(event)">

<div id="gate" onclick="initApp()">
    <div style="font-size: 50px; font-weight: 100; letter-spacing: 15px;">2026</div>
    <div style="margin-top: 25px; border: 1px solid var(--gold); padding: 12px 35px; border-radius: 30px; letter-spacing: 3px;">å¼€å¯ç’€ç’¨ä¹‹å¤œ</div>
</div>

<div class="audio-box">
    <div class="music-ctrl" onclick="toggleMusic()"><span id="playIcon">ğŸµ</span></div>
    <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5" oninput="changeVolume(this.value)">
</div>

<div class="video-window">
    <video id="side-video" loop muted autoplay playsinline>
        <source src="company.mp4" type="video/mp4">
    </video>
</div>

<canvas id="canvas"></canvas>

<div id="timer-wrap">
    <div id="timer">00</div>
    <div style="color: var(--gold); letter-spacing: 10px; font-size: 14px; opacity: 0.8; margin-top: 10px;">AWAITS 2026</div>
</div>

<div id="count-down-boom"></div>
<div id="packet-grid"></div>
<div id="final-msg">æ„¿ 2026<br>æ‰€æœ‰ç¾å¥½å¦‚çº¦è€Œè‡³</div>

<div class="console" onclick="event.stopPropagation()">
    <input type="text" id="wishInput" placeholder="åœ¨æ­¤é•Œåˆ»æ‚¨çš„æ„¿æœ›...">
    <button onclick="sendWish()">â†‘</button>
</div>

<audio id="bgm" loop playsinline>
    <source src="é»„æ˜æ™“.mp3" type="audio/mpeg">
</audio>

<script>
    let audioCtx, analyser, dataArray, source;
    const boomEl = document.getElementById('count-down-boom');
    const timerWrap = document.getElementById('timer-wrap');
    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
    let particles = [];
    let isNewYear = false;
    let currentBatchIdx = 0;

    const auspiciousPhrases = ["ä¸‡äº‹å¦‚æ„", "å¿ƒæƒ³äº‹æˆ", "å¤§å‰å¤§åˆ©", "è´¢æºå¹¿è¿›", "å²å²å¹³å®‰", "æ­¥æ­¥é«˜å‡", "ç¦æ°”æ»¡æ»¡", "å–œæ°”ç›ˆé—¨", "ç¦æ˜Ÿé«˜ç…§", "å¹´å¹´æœ‰ä½™"];
    const allBatchData = [
        ["æ–°æ˜¥å¤§å‰", "ä¸‡äº‹å¦‚æ„", "å¿ƒæƒ³äº‹æˆ", "èº«ä½“å¥åº·"],
        ["è´¢æºå¹¿è¿›", "å¤§å‰å¤§åˆ©", "å²å²å¹³å®‰", "æ­¥æ­¥é«˜å‡"],
        ["é‡‘æ¦œé¢˜å", "å¦‚è™æ·»ç¿¼", "å–œæ°”ç›ˆé—¨", "ç¦æ˜Ÿé«˜ç…§"]
    ];

    // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
    function initAudioContext() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    // é¢‘è°±åˆ†æè®¾ç½®
    function setupAudioAnalyse() {
        if (analyser) return; // é˜²æ­¢é‡å¤åˆå§‹åŒ–
        const bgm = document.getElementById('bgm');
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 64;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        
        source = audioCtx.createMediaElementSource(bgm);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
        beatFire();
    }

    function initApp() {
        document.getElementById('gate').style.display = 'none';
        initAudioContext();
        
        const bgm = document.getElementById('bgm');
        bgm.volume = 0.5;
        
        // å…³é”®ä¿®å¤ï¼šé€šè¿‡ Promise æ’­æ”¾å¹¶æ•è·é”™è¯¯
        bgm.play().then(() => {
            setupAudioAnalyse(); 
            console.log("Music started successfully");
        }).catch(err => {
            console.error("Audio play failed:", err);
            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œé€šè¿‡æ§åˆ¶æŒ‰é’®å†æ¬¡å°è¯•
            document.getElementById('playIcon').innerText = 'ğŸ”‡';
        });
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        setInterval(updateClock, 1000);
        render();
    }

    function playBoomSound() {
        initAudioContext();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start(); osc.stop(audioCtx.currentTime + 0.5);
    }

    // æ–‡å­—çƒŸèŠ±é€»è¾‘ (æµæ˜Ÿæ‹–å°¾)
    function fireText(text, x, y, isBig = false) {
        if ('vibrate' in navigator) navigator.vibrate(20);
        
        const fontSize = isBig ? Math.min(window.innerWidth / 4, 120) : Math.min(window.innerWidth / 10, 45);
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = window.innerWidth;
        tempCanvas.height = window.innerHeight;

        tempCtx.fillStyle = "#fff";
        tempCtx.font = `bold ${fontSize}px Arial`;
        tempCtx.textAlign = "center";
        tempCtx.textBaseline = "middle";
        tempCtx.fillText(text, x, y);

        const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height).data;
        const step = isBig ? 8 : 5; 
        const hue = Math.random() * 360;

        for (let i = 0; i < tempCanvas.height; i += step) {
            for (let j = 0; j < tempCanvas.width; j += step) {
                const index = (i * tempCanvas.width + j) * 4;
                if (imageData[index + 3] > 128) {
                    particles.push({
                        x: j, y: i,
                        color: `hsl(${hue}, 100%, 75%)`,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        alpha: 1,
                        decay: isBig ? 0.005 : 0.008,
                        gravity: 0.05 + Math.random() * 0.1,
                        isMeteor: true 
                    });
                }
            }
        }
        playBoomSound();
    }

    // éŸ³ä¹èŠ‚å¥æ£€æµ‹
    function beatFire() {
        if(!isNewYear || !analyser) {
            requestAnimationFrame(beatFire);
            return;
        }
        analyser.getByteFrequencyData(dataArray);
        const avg = dataArray.reduce((a,b)=>a+b, 0) / dataArray.length;
        if(avg > 130 && Math.random() < 0.1) {
            fire(Math.random()*canvas.width, Math.random()*canvas.height*0.5);
        }
        requestAnimationFrame(beatFire);
    }

    // åŸæœ‰é€»è¾‘ä¿æŒ
    function updateClock() {
        if (isNewYear) return;
        const target = new Date('2026/01/01 00:00:00');
        const diff = target - new Date();
        const sec = Math.max(0, Math.floor(diff / 1000));
        if (sec <= 3 && sec > 0) playBoomSound();
        if (sec <= 0) {
            isNewYear = true;
            timerWrap.style.display = 'none';
            runFinalCountdown();
            return;
        }
        document.getElementById('timer').innerText = sec < 10 ? '0'+sec : sec;
    }

    function runFinalCountdown() {
        const steps = ['3', '2', '1', 'æ–°å¹´å¿«ä¹'];
        let i = 0;
        const next = () => {
            if (i < steps.length) {
                boomEl.innerText = steps[i];
                boomEl.style.animation = 'boomAnim 1s forwards';
                if (steps[i] === 'æ–°å¹´å¿«ä¹') {
                    setTimeout(() => fireText("2026", canvas.width/2, canvas.height/2, true), 200);
                } else {
                    fireBatch(5);
                }
                i++;
                setTimeout(next, 1000);
            } else {
                startBatch(0);
                fireBatch(15);
            }
        };
        next();
    }

    function fire(x, y) {
        playBoomSound();
        const hue = Math.random()*360;
        for(let i=0; i<100; i++) {
            particles.push({
                x, y, color: `hsl(${hue}, 100%, 70%)`,
                vx: (Math.random()-0.5) * 16, vy: (Math.random()-0.5) * 16,
                alpha: 1, decay: 0.01 + Math.random()*0.02
            });
        }
    }

    function fireBatch(count) {
        for(let i=0; i<count; i++) {
            setTimeout(() => fire(Math.random()*canvas.width, Math.random()*canvas.height*0.6), i * 150);
        }
    }

    function manualFire(e) {
        if(!isNewYear) return;
        const phrase = auspiciousPhrases[Math.floor(Math.random() * auspiciousPhrases.length)];
        fireText(phrase, e.clientX, e.clientY);
    }

    function render() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; 
        ctx.fillRect(0,0,canvas.width, canvas.height);
        particles.forEach((p, i) => {
            if (p.isMeteor) {
                p.vx *= 0.99; p.vy += p.gravity;
            } else {
                p.vx *= 0.98; p.vy *= 0.98; p.vy += 0.15;
            }
            p.x += p.vx; p.y += p.vy; p.alpha -= p.decay;
            ctx.globalAlpha = Math.max(0, p.alpha);
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.isMeteor?1.5:2.2, 0, Math.PI*2); ctx.fill();
            if(p.alpha <= 0) particles.splice(i, 1);
        });
        requestAnimationFrame(render);
    }

    function startBatch(idx) {
        currentBatchIdx = idx;
        const grid = document.getElementById('packet-grid');
        grid.innerHTML = ''; grid.style.display = 'grid';
        let opened = 0;
        allBatchData[idx].forEach(txt => {
            const item = document.createElement('div');
            item.className = 'packet-item'; item.innerHTML = `<div class="seal">ç¦</div>`;
            item.onclick = (e) => {
                e.stopPropagation();
                if(item.style.opacity === '0') return;
                item.style.opacity = '0'; opened++;
                showGatherText(txt);
                if(opened === allBatchData[idx].length) {
                    setTimeout(() => {
                        if(currentBatchIdx < allBatchData.length - 1) startBatch(currentBatchIdx + 1);
                        else { grid.style.display = 'none'; document.getElementById('final-msg').classList.add('show'); document.body.classList.add('final-glow'); }
                    }, 2500);
                }
            };
            grid.appendChild(item);
        });
    }

    function showGatherText(text) {
        const t = document.createElement('div');
        t.innerText = text;
        t.style.cssText = `position:absolute; left:50%; top:40%; transform:translate(-50%,-50%); z-index:1600; font-size:42px; font-weight:900; color:var(--gold); text-shadow:0 0 20px var(--gold); animation:gather 3s forwards; pointer-events:none;`;
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 3000);
    }

    function toggleMusic() {
        const bgm = document.getElementById('bgm');
        initAudioContext();
        if(bgm.paused) { bgm.play(); document.getElementById('playIcon').innerText = 'ğŸµ'; }
        else { bgm.pause(); document.getElementById('playIcon').innerText = 'ğŸ”‡'; }
    }

    function changeVolume(v) { document.getElementById('bgm').volume = v; }

    function sendWish() {
        const val = document.getElementById('wishInput').value;
        if(!val) return;
        const levelMap = [{ k: 12, size: 32, prefix:'ğŸ‰' }, { k: 6, size: 26, prefix:'âœ¨' }, { k: 0, size: 20, prefix:'ğŸ’«' }];
        const level = levelMap.find(l => val.length >= l.k);
        const d = document.createElement('div');
        d.style.cssText = `position:absolute; white-space:nowrap; font-weight:900; z-index:30; pointer-events:none; color:var(--gold); text-shadow:0 0 10px var(--gold); top:${15+Math.random()*60}%; left:100vw; font-size:${level.size}px;`;
        d.innerText = level.prefix + " " + val;
        document.body.appendChild(d);
        d.animate([{transform:'translateX(0)'}, {transform:`translateX(-${window.innerWidth+1200}px)`}], 8000).onfinish = () => d.remove();
        document.getElementById('wishInput').value = '';
    }

    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
</script>
</body>
</html>
