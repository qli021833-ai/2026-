<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>2026 ç’€ç’¨ä¹‹çº¦ Â· å½±éŸ³å…¨åŠŸèƒ½å®Œç¾ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    <style>
        :root { 
            --gold: #f3cf7a; 
            --red: #d32f2f;
            --glass: rgba(0, 0, 0, 0.85);
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #050505; font-family: "PingFang SC", "Microsoft YaHei", sans-serif; }

        /* å³ä¸Šè§’è§†é¢‘ */
        .video-window {
            position: absolute; right: 30px; top: 30px; width: 280px; height: 158px;
            z-index: 20; border-radius: 12px; border: 1px solid var(--gold);
            overflow: hidden; background: #000; box-shadow: 0 0 30px rgba(243, 207, 122, 0.3);
        }
        #side-video { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }

        canvas { position: absolute; inset: 0; z-index: 5; pointer-events: none; }

        /* å€’è®¡æ—¶ */
        #timer { 
            position: absolute; inset: 0; display: flex; justify-content: center; align-items: center;
            font-size: 110px; font-weight: 100; color: white; z-index: 10; letter-spacing: 12px;
            text-shadow: 0 0 30px rgba(255,255,255,0.4);
        }

        /* å¼¹å¹•å‘é€åŒºåŸŸ */
        .console {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; width: 400px; padding: 12px 25px;
            background: var(--glass); border-radius: 50px; border: 1px solid var(--gold);
        }
        .console input { background: transparent; border: none; color: #fff; flex: 1; outline: none; font-size: 16px; }
        .console button { background: var(--gold); border: none; border-radius: 50%; width: 38px; height: 38px; cursor: pointer; font-weight: bold; }

        /* å¼¹å¹•æ ·å¼ï¼šå¢åŠ æ°”æ³¡è¾¹æ¡†åŒºåˆ† */
        .dm { 
            position: absolute; white-space: nowrap; font-weight: 900; z-index: 30; 
            pointer-events: none; padding: 8px 20px; border-radius: 30px;
            display: flex; align-items: center; gap: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* çº¢åŒ…é˜µåˆ— */
        #packet-grid {
            position: absolute; inset: 0; display: grid; 
            grid-template-columns: repeat(3, 1fr); grid-gap: 40px;
            padding: 140px 180px; z-index: 100; display: none;
            justify-items: center; align-items: center;
        }
        .packet-item {
            width: 120px; height: 175px; background: var(--red); border-radius: 12px;
            border: 2px solid var(--gold); cursor: pointer; position: relative;
            animation: float 3s infinite ease-in-out; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .packet-item.opened { opacity: 0; transform: scale(0) rotate(180deg); pointer-events: none; }
        .seal { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: var(--gold); border-radius: 50%; color: var(--red); font-weight: bold; display: flex; align-items: center; justify-content: center; font-size: 22px; }

        /* æ±‡èšæ–‡å­— */
        .gather-text {
            position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
            z-index: 150; font-size: 70px; font-weight: 900; opacity: 0; pointer-events: none;
            background: linear-gradient(to right, #fff, var(--gold), #fff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: gather 3.5s forwards;
        }

        /* éŸ³é‡ä¸æ§åˆ¶å›å½’ */
        .music-ctrl {
            position: absolute; left: 30px; bottom: 30px; z-index: 1100;
            display: flex; align-items: center; background: var(--glass); padding: 10px 18px;
            border-radius: 40px; border: 1px solid var(--gold); color: white;
            transition: 0.4s; width: 45px; overflow: hidden; white-space: nowrap;
        }
        .music-ctrl:hover { width: 200px; }
        #volSlider { width: 80px; margin-left: 15px; cursor: pointer; accent-color: var(--gold); }
        .ctrl-icon { cursor: pointer; font-size: 18px; width: 25px; text-align: center; }

        #final-msg {
            position: absolute; inset: 0; display: flex; justify-content: center; align-items: center;
            z-index: 500; color: var(--gold); font-size: 60px; font-weight: bold;
            opacity: 0; transition: 5s; pointer-events: none; letter-spacing: 12px;
        }
        #final-msg.show { opacity: 1; transform: scale(1.1); }

        #gate { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; justify-content: center; align-items: center; cursor: pointer; color: var(--gold); flex-direction: column; }
        @keyframes gather { 0% { opacity: 0; transform: translate(var(--sx), var(--sy)) scale(0.1); filter: blur(20px); } 30% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); filter: blur(0); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(1.8); filter: blur(30px); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body>

<div id="gate" onclick="initApp()">
    <div style="font-size: 50px; letter-spacing: 20px;">2026</div>
    <div style="opacity: 0.6; margin-top:10px;">ç‚¹å‡»å¼€å¯å…¨æ„Ÿå®˜è´ºå²</div>
</div>

<div class="video-window">
    <video id="side-video" loop muted autoplay playsinline>
        <source src="D:\desktop\1\company.mp4" type="video/mp4">
    </video>
</div>

<canvas id="canvas"></canvas>
<div id="timer">00:00:00</div>
<div id="packet-grid"></div>
<div id="final-msg">æ„¿2026æ‰€æœ‰ç¾å¥½å¦‚æœŸè€Œè‡³</div>

<div class="music-ctrl">
    <span class="ctrl-icon" id="playBtn" onclick="toggleMusic()">ğŸµ</span>
    <input type="range" id="volSlider" min="0" max="1" step="0.1" value="0.8">
</div>

<div class="console">
    <input type="text" id="wishInput" placeholder="å†™ä¸‹æ„¿æœ›ï¼Œç‚¹å‡»å‘é€...">
    <button onclick="sendWish()">â†‘</button>
</div>

<audio id="bgm" loop><source src="D:\desktop\1\é»„æ˜æ™“.mp3" type="audio/mpeg"></audio>

<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    // éŸ³æ•ˆå¼•æ“ï¼šä¿®æ­£çˆ†ç«¹è´¨æ„Ÿä¸Biuå‡ç©º
    function playEffect(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const now = audioCtx.currentTime;
        const gain = audioCtx.createGain();
        gain.connect(audioCtx.destination);

        if(type === 'biu') {
            const osc = audioCtx.createOscillator();
            osc.connect(gain);
            osc.frequency.setValueAtTime(120, now);
            osc.frequency.exponentialRampToValueAtTime(1000, now + 0.4);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.4);
            osc.start(); osc.stop(now + 0.4);
        } 
        else if(type === 'cracker') { 
            // çœŸå®çˆ†ç«¹ï¼šç™½å™ªå£° + å¸¦é€šæ»¤æ³¢
            const bufferSize = audioCtx.sampleRate * 0.12;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(1800, now);
            
            noise.connect(filter);
            filter.connect(gain);
            gain.gain.setValueAtTime(0.4, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);
            noise.start(); noise.stop(now + 0.12);
        }
        else if(type === 'boom') {
            const osc = audioCtx.createOscillator();
            osc.type = 'triangle';
            osc.connect(gain);
            osc.frequency.setValueAtTime(55, now);
            gain.gain.setValueAtTime(0.8, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);
            osc.start(); osc.stop(now + 1.2);
        }
    }

    function speak() {
        const msg = new SpeechSynthesisUtterance("æ–°å¹´å¿«ä¹");
        msg.pitch = 0.8 + Math.random() * 0.4;
        msg.rate = 1.0;
        window.speechSynthesis.speak(msg);
    }

    const batchData = [
        ["æ–°å¹´å¿«ä¹", "ğŸ§¨ ä¸‡äº‹å¦‚æ„ ğŸ§¨", "âœ¨ å²å²å¹³å®‰ âœ¨", "ğŸš€ 2026 å¤§å‰"],
        ["ğŸ’° è´¢æºå¹¿è¿›", "ğŸŒŸ æ˜Ÿè¾°å¤§æµ·", "ğŸ¦ é¾™è…¾è™è·ƒ"],
        ["ğŸŒˆ å‰ç¨‹ä¼¼é”¦", "ğŸŒ™ æ­¤æ—¶åœ†æ»¡", "ğŸ å¹³å®‰å–œä¹"]
    ];

    let currentBatch = 0, openedCount = 0, isNewYear = false;
    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
    let particles = [];

    function initApp() {
        document.getElementById('gate').style.opacity = '0';
        setTimeout(() => document.getElementById('gate').remove(), 600);
        const bgm = document.getElementById('bgm');
        bgm.play();
        bgm.volume = 0.8;
        
        document.getElementById('volSlider').oninput = (e) => {
            bgm.volume = e.target.value;
        };

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        setInterval(updateClock, 1000);
        render(); // å¯åŠ¨æ¸²æŸ“
    }

    function updateClock() {
        if (isNewYear) return;
        const target = new Date('2026/01/01 00:00:00'); 
        const diff = target - new Date();
        const sec = Math.floor(diff / 1000);
        if (sec <= 0) {
            isNewYear = true;
            document.getElementById('timer').style.display = 'none';
            playEffect('biu');
            setTimeout(() => {
                playEffect('boom');
                speak();
                startBatch(0);
            }, 400);
            return;
        }
        document.getElementById('timer').innerText = sec < 10 ? `0${sec}` : sec;
    }

    function startBatch(idx) {
        currentBatch = idx; openedCount = 0;
        const grid = document.getElementById('packet-grid');
        grid.innerHTML = ''; grid.style.display = 'grid';
        batchData[idx].forEach((text, i) => {
            const el = document.createElement('div');
            el.className = 'packet-item';
            el.innerHTML = '<div class="seal">é–‹</div>';
            el.onclick = (e) => {
                if(el.classList.contains('opened')) return;
                el.classList.add('opened');
                openedCount++;
                playEffect('cracker'); // çˆ†ç«¹å£°
                spawnSpark(e.clientX, e.clientY);
                showGatherText(text);
                if(openedCount === batchData[currentBatch].length) {
                    setTimeout(() => {
                        if(currentBatch < batchData.length - 1) startBatch(currentBatch+1);
                        else showFinal();
                    }, 3800);
                }
            };
            grid.appendChild(el);
        });
    }

    function showGatherText(text) {
        const t = document.createElement('div');
        t.className = 'gather-text';
        t.innerText = text;
        const pos = [['-80vw','-80vh'],['80vw','-80vh']][Math.floor(Math.random()*2)];
        t.style.setProperty('--sx', pos[0]); t.style.setProperty('--sy', pos[1]);
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 3500);
    }

    function toggleMusic() {
        const bgm = document.getElementById('bgm');
        const btn = document.getElementById('playBtn');
        if(bgm.paused) { bgm.play(); btn.innerText = 'ğŸµ'; }
        else { bgm.pause(); btn.innerText = 'ğŸ”‡'; }
    }

    function sendWish() {
        const val = document.getElementById('wishInput').value;
        if(!val) return;
        spawnDM(val, true);
        document.getElementById('wishInput').value = '';
    }

    // å¼ºåŒ–å¼¹å¹•ï¼šæ°”æ³¡æ„Ÿ + éšæœºé…è‰²
    function spawnDM(text, isMe) {
        const d = document.createElement('div');
        d.className = 'dm';
        const hue = Math.random() * 360;
        const size = isMe ? 34 : (20 + Math.random() * 14);
        d.innerHTML = `<span>${isMe?'ğŸ‘‘':'âœ¨'}</span> ${text}`;
        d.style.cssText = `
            left: 100vw; top: ${15 + Math.random() * 65}%;
            color: hsl(${hue}, 80%, 75%);
            font-size: ${size}px;
            background: hsla(${hue}, 80%, 15%, 0.7);
            border: 1.5px solid hsla(${hue}, 80%, 70%, 0.5);
            box-shadow: 0 0 15px hsla(${hue}, 80%, 70%, 0.3);
        `;
        document.body.appendChild(d);
        d.animate([{left: '100vw'}, {left: '-1200px'}], 7000 + Math.random()*4000).onfinish = () => d.remove();
    }

    function spawnSpark(x, y) {
        for(let i=0; i<45; i++) {
            particles.push({
                x, y, color: Math.random()>0.5?'#ff4d4d':'#f3cf7a',
                vx: (Math.random()-0.5)*28, vy: (Math.random()-0.5)*28,
                a: 1, d: 0.04, size: Math.random()*3.5+1, sparkle: true
            });
        }
    }

    function firework(x, y) {
        const hue = Math.random()*360;
        for(let i=0; i<100; i++) {
            particles.push({
                x, y, color: `hsl(${hue}, 100%, 70%)`,
                vx: (Math.random()-0.5)*18, vy: (Math.random()-0.5)*18,
                a: 1, d: 0.015, size: 2.5
            });
        }
    }

    function showFinal() {
        document.getElementById('packet-grid').style.display = 'none';
        document.getElementById('final-msg').classList.add('show');
        // ç»“å°¾åŠ å¼ºç‰ˆå¯†é›†çƒŸèŠ±
        setInterval(() => {
            if(Math.random()>0.5) { 
                playEffect('biu'); 
                setTimeout(() => {
                    playEffect('boom');
                    if(Math.random()>0.6) speak();
                    firework(Math.random()*canvas.width, Math.random()*canvas.height*0.5);
                }, 400);
            }
        }, 800);
    }

    // æ¸²æŸ“ä¸»å¾ªç¯ï¼šæ¢å¤å¸¸æ€åŒ–éšæœºçƒŸèŠ±
    function render() {
        ctx.fillStyle = 'rgba(5, 5, 5, 0.25)';
        ctx.fillRect(0,0,canvas.width, canvas.height);
        
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.vy += 0.15; p.a -= p.d;
            if(p.sparkle && Math.random()>0.8) ctx.globalAlpha = 0; else ctx.globalAlpha = p.a;
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
            if(p.a <= 0) particles.splice(i, 1);
        });

        // æ¢å¤ï¼šå¹³æ—¶ä¹Ÿä¼šå‡ºç°çš„éšæœºå°çƒŸèŠ±
        if(Math.random() < 0.04) {
            firework(Math.random()*canvas.width, Math.random()*canvas.height*0.7);
        }

        requestAnimationFrame(render);
    }
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
</script>
</body>
</html>