<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>2026 Â· ç’€ç’¨æ–°å¹´</title>

<style>
:root{--gold:#f3cf7a;--glass:rgba(0,0,0,.6)}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;width:100%;height:100%;background:#000;color:#fff;font-family:-apple-system;overflow:hidden;user-select:none}
canvas{position:fixed;inset:0;z-index:1}

/* Gate - å…¥å£ */
#gate{position:fixed;inset:0;z-index:3000;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#000;color:var(--gold)}
#gate h1{font-size:60px;letter-spacing:15px;font-weight:200;margin:0}
#gate p{font-size:14px;opacity:0.8;margin:20px 0 40px}
#gate span{border:1px solid var(--gold);padding:12px 35px;border-radius:30px;cursor:pointer;animation:pulse 2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(243,207,122,0.4)}70%{box-shadow:0 0 0 15px rgba(243,207,122,0)}100%{box-shadow:0 0 0 0 rgba(243,207,122,0)}}

/* Audio - éŸ³é¢‘æ§åˆ¶ */
#audio{position:fixed;top:15px;left:15px;z-index:2500;display:flex;gap:10px;align-items:center;background:var(--glass);border:1px solid var(--gold);border-radius:30px;padding:6px 14px;backdrop-filter:blur(10px)}
#audio button{background:none;border:none;color:var(--gold);font-size:18px;cursor:pointer}
#audio input{width:60px;accent-color:var(--gold)}

/* Timer & Shake - å€’è®¡æ—¶ä¸éœ‡åŠ¨ */
#timerWrap{position:fixed;inset:0;z-index:5;display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none}
#timer{font-size:120px;font-weight:100;letter-spacing:10px;text-shadow:0 0 40px var(--gold); transition: all 0.3s;}
#sub{letter-spacing:8px;color:var(--gold);opacity:.8}

.shake-screen { animation: shakeEffect 0.3s ease-in-out; }
@keyframes shakeEffect {
    0% { transform: translate(2px, 2px); }
    25% { transform: translate(-2px, -3px); }
    50% { transform: translate(3px, 0px); }
    75% { transform: translate(-2px, 2px); }
    100% { transform: translate(0, 0); }
}

/* Combo - è¿å‡»UI */
#comboUI{position:fixed;right:30px;top:100px;font-family:Impact, sans-serif;color:var(--gold);font-size:45px;font-style:italic;opacity:0;z-index:2000;text-shadow:0 0 20px var(--gold);pointer-events:none;transition:0.1s}

/* Boom Text - å€’è®¡æ—¶å†²å‡»æ–‡å­— */
#boomText{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);font-size:160px;font-weight:900;color:var(--gold);opacity:0;pointer-events:none;z-index:10;text-shadow:0 0 60px var(--gold)}
@keyframes boom{0%{transform:translate(-50%,-50%) scale(.3);opacity:0}50%{opacity:1}100%{transform:translate(-50%,-50%) scale(2.2);opacity:0}}

/* Packet Grid - çº¢åŒ… */
#packetGrid{position:fixed;inset:0;z-index:100;display:none;grid-template-columns:repeat(2,1fr);gap:20px;align-content:center;justify-items:center;padding:120px 40px}
.packet{width:110px;height:150px;background:linear-gradient(135deg,#b71c1c,#d32f2f);border-radius:12px;border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:40px;font-weight:900;color:var(--gold);cursor:pointer;animation:wobble 2s infinite;box-shadow:0 10px 20px rgba(0,0,0,0.5)}
@keyframes wobble{0%,100%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}}

/* Final Content - ç»“å°¾ */
#final{position:fixed;inset:0;display:none;flex-direction:column;justify-content:center;align-items:center;z-index:20;text-align:center;background:rgba(0,0,0,0.4)}
#final h2{font-size:36px;background:linear-gradient(90deg,var(--gold),#fff,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px;letter-spacing:8px}
#keyword{margin-top:20px;font-size:22px;color:var(--gold);font-weight:bold;letter-spacing:3px}

/* Danmu - å¼¹å¹• */
#danmuBar{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:2000;display:flex;gap:10px;background:var(--glass);border:1px solid var(--gold);border-radius:30px;padding:6px 16px;backdrop-filter:blur(10px)}
#danmuBar input{background:none;border:none;color:#fff;outline:none;width:150px}
#danmuBar button{background:var(--gold);border:none;border-radius:50%;width:30px;height:30px;font-weight:bold;cursor:pointer;color:#821111}

@keyframes float { 0%, 100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-20px) rotate(10deg); } }
@keyframes blessFade{ 0%{opacity:0;transform:translate(-50%,-30%) scale(.8)} 20%{opacity:1} 80%{opacity:1} 100%{opacity:0;transform:translate(-50%,-100%) scale(1.2)} }
</style>
</head>

<body onclick="manualFire(event)">

<div id="gate" onclick="startApp()">
    <h1>2026</h1>
    <p>ç‚¹å‡»å¼€å¯ç’€ç’¨ä¹‹å¤œ Â· å»ºè®®å¼€å¯å£°éŸ³</p>
    <span>è¿›å…¥æ–°å¹´</span>
</div>

<div id="audio">
  <button id="musicBtn" onclick="toggleMusic(event)">ğŸµ</button>
  <input id="volRange" type="range" min="0" max="1" step="0.1" value="0.4" onclick="event.stopPropagation()">
</div>

<div id="comboUI">COMBO X1</div>

<div id="timerWrap">
    <div id="timer">3</div>
    <div id="sub">AWAITS 2026</div>
</div>

<div id="boomText"></div>
<div id="packetGrid"></div>

<div id="final">
    <h2>æ„¿ 2026</h2>
    <p style="color:#ddd; letter-spacing:2px">æ‰€æœ‰ç¾å¥½å¦‚çº¦è€Œè‡³</p>
    <div id="keyword"></div>
    <p style="font-size:12px;margin-top:30px;opacity:0.6;color:#fff">æ‘‡æ™ƒæ‰‹æœº æˆ– è¿ç»­ç‚¹å‡» è§¦å‘ç‹‚æ¬¢</p>
</div>

<div id="danmuBar" onclick="event.stopPropagation()">
  <input id="danmuInput" placeholder="å†™ä¸‹æ–°å¹´æ„¿æœ›...">
  <button onclick="sendDanmu()">â†‘</button>
</div>

<canvas id="c"></canvas>

<audio id="bgm" loop playsinline>
  <source src="é»„æ˜æ™“.mp3" type="audio/mpeg">
</audio>

<script>
const canvas=c, ctx=canvas.getContext('2d');
let particles=[];
let stars=[];
let audioCtx;
let combo = 0, comboTimer;
const PHASE={WAIT:0, COUNTDOWN:1, CELE:2};
let phase=PHASE.WAIT;

const batches=[
    ["æ–°æ˜¥å¤§å‰","ä¸‡äº‹å¦‚æ„","å¿ƒæƒ³äº‹æˆ","èº«ä½“å¥åº·"],
    ["è´¢æºå¹¿è¿›","æ­¥æ­¥é«˜å‡","å²å²å¹³å®‰","å¤§å‰å¤§åˆ©"],
    ["é‡‘æ¦œé¢˜å","å–œæ°”ç›ˆé—¨","ç¦æ˜Ÿé«˜ç…§","å¹´å¹´æœ‰ä½™"]
];
let batchIndex=0;
const keywords=["é”¦é²¤é™„ä½“","æš´å¯Œç¿»èº«","çƒ­çƒˆè‡ªç”±","è¢«åçˆ±","é—ªé—ªå‘å…‰","ä¸‡äº‹èƒœæ„"];

/* ===== åˆå§‹åŒ–ä¸èƒŒæ™¯ (ç»“åˆ34çš„æ˜Ÿç©º) ===== */
function resize(){
    canvas.width=innerWidth; 
    canvas.height=innerHeight;
    initStars();
}
window.onresize = resize;

function initStars() {
    stars = [];
    for(let i=0; i<150; i++) {
        stars.push({
            x: Math.random()*canvas.width, 
            y: Math.random()*canvas.height, 
            size: Math.random()*1.8, 
            blink: Math.random()*Math.PI
        });
    }
}

/* ===== éŸ³æ•ˆç³»ç»Ÿ (ä¿ç•™28çš„æ ¸å¿ƒ) ===== */
function playBoomSound() {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(150, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
    osc.start(); osc.stop(audioCtx.currentTime + 0.4);
}

/* ===== æ ¸å¿ƒæµç¨‹ ===== */
function startApp(){
    gate.style.display='none';
    bgm.play().catch(()=>{});
    volRange.oninput = (e) => { bgm.volume = e.target.value; };
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    resize();
    runCountdown();
    render();
    initShake();
}

// æŒ¯å¥‹äººå¿ƒçš„å€’è®¡æ—¶é€»è¾‘
function runCountdown() {
    phase = PHASE.COUNTDOWN;
    let count = 3;
    
    const triggerStep = (val) => {
        // è§†è§‰éœ‡åŠ¨åé¦ˆ
        document.body.classList.remove('shake-screen');
        void document.body.offsetWidth;
        document.body.classList.add('shake-screen');
        
        timer.innerText = val;
        boomText.innerText = val;
        boomText.style.animation = 'none';
        void boomText.offsetWidth;
        boomText.style.animation = 'boom 0.8s forwards';
        
        playBoomSound();
        fire(canvas.width/2, canvas.height/2, 50); // å€’è®¡æ—¶ä¸­å¿ƒé¢„çƒ­çƒŸèŠ±
    };

    const timerInterval = setInterval(() => {
        count--;
        if(count > 0) {
            triggerStep(count);
        } else if(count === 0) {
            triggerStep("2026");
            timer.innerText = "00";
        } else {
            clearInterval(timerInterval);
            phase = PHASE.CELE;
            timerWrap.style.display = 'none';
            startBatch(0);
            setInterval(spawnMascot, 4000);
            setInterval(updateClock, 1000); // æ¢å¤28çš„åŸæœ‰æ—¶é—´æ£€æµ‹
        }
    }, 1000);
    
    triggerStep(3);
}

function updateClock(){
    if(phase !== PHASE.CELE) return;
    // ä¿æŒ28çš„é€»è¾‘å®Œæ•´
}

/* ===== äº’åŠ¨ç³»ç»Ÿ (æ–°å¢Comboä¸å‰ç¥¥ç‰©) ===== */
function manualFire(e){
    if(phase === PHASE.WAIT) return;
    
    // è¿å‡»é€»è¾‘
    combo++;
    comboUI.innerText = `COMBO X${combo}`;
    comboUI.style.opacity = combo > 1 ? 1 : 0;
    comboUI.style.transform = `scale(${1 + combo*0.05})`;
    clearTimeout(comboTimer);
    comboTimer = setTimeout(() => { combo = 0; comboUI.style.opacity = 0; }, 800);

    fire(e.clientX, e.clientY, combo > 5 ? 120 : 80);
}

function spawnMascot() {
    if (phase !== PHASE.CELE) return;
    const emojis = ['ğŸ¦','ğŸ®','ğŸ§§','ğŸ’°','âœ¨','ğŸŠ'];
    const m = document.createElement('div');
    m.innerText = emojis[Math.floor(Math.random()*emojis.length)];
    m.style.cssText = `position:fixed; font-size:42px; z-index:1200; cursor:pointer; left:${15+Math.random()*70}vw; top:${25+Math.random()*45}vh; animation: float 4s ease-in-out infinite; user-select:none;`;
    m.onclick = (e) => {
        e.stopPropagation();
        fire(e.clientX, e.clientY, 150);
        showBless("é¸¿è¿å½“å¤´ âœ¨");
        m.remove();
    };
    document.body.appendChild(m);
    setTimeout(() => { if(m.parentNode) m.remove(); }, 7000);
}

/* ===== çº¢åŒ…ä¸ç¥ç¦è¯­ (ä¿ç•™28) ===== */
function startBatch(i){
    batchIndex = i;
    packetGrid.innerHTML = '';
    packetGrid.style.display = 'grid';
    let opened = 0;
    batches[i].forEach(text => {
        const p = document.createElement('div');
        p.className = 'packet';
        p.innerText = 'ç¦';
        p.onclick = (e) => {
            e.stopPropagation();
            if(p.style.opacity === '0') return;
            p.style.opacity = 0;
            showBless(text);
            setTimeout(() => fireText(text), 300);
            opened++;
            if(opened === batches[i].length){
                setTimeout(() => {
                    if(batchIndex < batches.length-1) startBatch(batchIndex+1);
                    else finishAll();
                }, 2000);
            }
        };
        packetGrid.appendChild(p);
    });
}

function showBless(text){
    const el = document.createElement('div');
    el.innerText = text;
    el.style.cssText = `position:fixed; left:50%; top:40%; transform:translate(-50%,-50%); font-size:42px; font-weight:900; color:var(--gold); letter-spacing:6px; text-shadow:0 0 20px var(--gold); z-index:2000; animation:blessFade 1.6s forwards; pointer-events:none;`;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1600);
}

function finishAll(){
    packetGrid.style.display = 'none';
    final.style.display = 'flex';
    keyword.innerText = '2026 å…³é”®è¯ï¼šã€' + keywords[Math.floor(Math.random()*keywords.length)] + 'ã€‘';
}

/* ===== çƒŸèŠ±ä¸æ¸²æŸ“ ===== */
function fire(x, y, count=80){
    playBoomSound();
    const h = Math.random()*360;
    for(let i=0; i<count; i++){
        particles.push({
            x, y, 
            vx:(Math.random()-0.5)*15, 
            vy:(Math.random()-0.5)*15, 
            a:1, 
            d:0.015+Math.random()*0.02, 
            c:`hsl(${h},100%,70%)`
        });
    }
}

function fireText(t){
    const tc = document.createElement('canvas'), tctx = tc.getContext('2d');
    tc.width = canvas.width; tc.height = canvas.height;
    tctx.fillStyle = '#fff'; tctx.font = 'bold 100px Arial';
    tctx.textAlign = 'center'; tctx.textBaseline = 'middle';
    tctx.fillText(t, tc.width/2, tc.height/2);
    const d = tctx.getImageData(0,0,tc.width,tc.height).data;
    const hue = Math.random()*360;
    for(let y=0; y<tc.height; y+=6) {
        for(let x=0; x<tc.width; x+=6) {
            if(d[(y*tc.width+x)*4+3] > 128) {
                particles.push({x, y, vx:(Math.random()-0.5)*2, vy:(Math.random()-0.5)*2, a:1, d:0.012, c:`hsl(${hue},100%,75%)`});
            }
        }
    }
    playBoomSound();
}

function render(){
    // èƒŒæ™¯ä¸æ˜Ÿç©º (èåˆ34)
    ctx.fillStyle = 'rgba(0,0,0,0.18)';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    stars.forEach(s => {
        s.blink += 0.02;
        ctx.globalAlpha = 0.3 + Math.abs(Math.sin(s.blink)) * 0.5;
        ctx.fillStyle = '#fff';
        ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
    });

    // ç²’å­æ¸²æŸ“ (ä¿ç•™28çš„é«˜è´¨é‡æ‹–å°¾)
    ctx.globalAlpha = 1;
    particles.forEach((p,i) => {
        p.vx *= 0.98; p.vy *= 0.98; p.vy += 0.15; p.x += p.vx; p.y += p.vy; p.a -= p.d;
        if(p.a <= 0) return particles.splice(i,1);
        ctx.globalAlpha = p.a; 
        ctx.fillStyle = p.c;
        ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
    });

    if(phase === PHASE.CELE && Math.random() < 0.04) fire(Math.random()*canvas.width, Math.random()*canvas.height*0.5);
    requestAnimationFrame(render);
}

function initShake() {
    let lastX, lastY, lastZ, lastUpdate = 0;
    window.addEventListener('devicemotion', e => {
        let cur = Date.now();
        if ((cur - lastUpdate) > 100) {
            let acc = e.accelerationIncludingGravity;
            if(!acc) return;
            let speed = Math.abs(acc.x + acc.y + acc.z - lastX - lastY - lastZ) / (cur - lastUpdate) * 10000;
            if (speed > 800) fire(Math.random()*canvas.width, Math.random()*canvas.height*0.5, 120);
            lastX=acc.x; lastY=acc.y; lastZ=acc.z; lastUpdate=cur;
        }
    });
}

function sendDanmu(){
    const t = danmuInput.value; if(!t) return;
    const d = document.createElement('div');
    d.style.cssText = `position:fixed; white-space:nowrap; font-weight:bold; color:var(--gold); z-index:2000; top:${15+Math.random()*50}%; left:100%; text-shadow:0 0 10px var(--gold)`;
    d.innerText = t; document.body.appendChild(d);
    d.animate([{transform:'translateX(0)'},{transform:`translateX(-${innerWidth+800}px)`}], 8000).onfinish = () => d.remove();
    danmuInput.value = '';
}

function toggleMusic(e){
    e.stopPropagation();
    bgm.paused ? (bgm.play(), musicBtn.innerText='ğŸµ') : (bgm.pause(), musicBtn.innerText='ğŸ”‡');
}
</script>
</body>
</html>
